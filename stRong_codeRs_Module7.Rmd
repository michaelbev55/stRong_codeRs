---
title: "Module 7 Report"
author: "stRong_codeRs"
date: "2023-11-07"
output: html_document
bibliography: "BIOL3140.bib"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(MuMIn)
library(tidyverse)
library(knitr)
```

## Introduction

Force produced by muslce tissue is determined by speed and length. This project will examine the effect of length of force generation and how eccentric fatigue affects this relationship. Force generated by the forearm can be used to gain insights into the force-length relationship, as outlined in @rassier1999length. We will use data generated at different angles to examine the force-length relationship, then how this relationship changes after the subject undergoes eccentric fatigue. By collecting and analyzing data we will determine how the angle at which maximum isometric force is produced changes across rested and fatigued subjects.

## Methods

Isometric force produced by MVC was measured using a Arduina based force-data acquisiton system. The load cell was anchored to a table and force was measured over a range of angles 45-157.25 degrees for each subject. Subjects that eccentrically fatigued the forearm with isokinetic controlled drops using a heavy backpack. MVC force data was then collected again.

Each subject's data was normalized to the max force value obtained. These data were than graphed to assess which changes across the two conditions. Polynomial models were then generated and selected for by lowest AIC values. An ANOVA test was then run on best models to assess whether max angle shifted across conditions. After it was determined that max angle did in fact shift, the mean shifted and standard error was computed.

## Results

```{r chunk 1, message=FALSE, echo=FALSE, warning=FALSE, include=FALSE}
f <- list.files("new_data", pattern = ".csv", full.names=TRUE)
dat.l <- list()

for(i in f){
  met.dat<- unlist(strsplit(i,"_"))
  who <- met.dat[3]
  activity <- met.dat[4]
  ang <- as.numeric(gsub(".csv","", met.dat[5]))
  dat.l[[i]]<- read_csv(i) %>%
  mutate(who = who, angle = ang, activity = activity)
}
dat <- do.call(rbind,dat.l)

filtered_dat <-  dat %>%
  filter(!(who=="letiacianna" | who=="leticianna" & activity %in% c("fatigue","control"))) %>%
  group_by(who,activity) %>%
  mutate(normF = abs(force)/(max(abs(force))))

```

```{r models, echo=FALSE, message=FALSE, warning=FALSE}

graph1 <- filtered_dat %>%
  ggplot(aes(angle,normF,col=activity))+geom_point()
graph1

```

##### Graph #1: This graph shows the relationship between the force and angle during both the control and fatigue experiments.  Although messy due to so many data points, you can see a shift towards largers angles under the fatigued condition.  Indicating that fatigued muscles produce max force at longer lengths.


```{r models2, echo=FALSE, message=FALSE, warning=FALSE}
AICs <- filtered_dat %>% 
  group_by(who,activity) %>% 
  summarize(
    pol.m2=AICc(lm(normF~poly(angle,2))),
    pol.m3=AICc(lm(normF~poly(angle,3))),
    pol.m4=AICc(lm(normF~poly(angle,4)))
  ) %>% 
  pivot_longer(pol.m2:pol.m4, names_to = "model", values_to = "AICc")


x.pred <- seq(45,157.5,length.out = 1000)

fits <- filtered_dat%>%
  group_by(who,activity)%>%
  summarize(
    pol.m2=predict(lm(normF~poly(angle,2)),newdata=data.frame(angle=x.pred)),
    pol.m3=predict(lm(normF~poly(angle,3)),newdata=data.frame(angle=x.pred)), 
    pol.m4=predict(lm(normF~poly(angle,4)),newdata=data.frame(angle=x.pred)) 
  )%>%
   pivot_longer(pol.m2:pol.m4,names_to="model")%>%
   group_by(who,activity,model)%>%
   summarize(theta_max=x.pred[which.max(value)])
  

```

```{r best, echo=FALSE, message=FALSE, warning=FALSE}
best.models <- fits%>%
  left_join(AICs)%>%
  group_by(who,activity)%>%
  mutate(best=AICc==min(AICc))%>%
  filter(best==TRUE)%>%
  dplyr::select(-best)
  
best.models %>% 
  kable(caption = "Depicts the model that fits best, determined by the lowest AIC value. 3rd or 4th degree polynomials were chosen exclusivily.")


```


##### ANOVA test to determine if max angle shift occured across condtions

```{r anova and best models, echo=FALSE, message=FALSE, warning=FALSE}
anova(lm(theta_max~activity,best.models)) %>% 
  print()
best.models%>%
  pivot_wider(id_cols=who,names_from = activity,values_from=theta_max)%>%
  mutate(shift=fatigue-control)%>%
  ungroup()%>%
  summarise(mean.shift=mean(shift,na.rm =TRUE),se.shift=sd(shift,na.rm=TRUE)/sqrt(length(shift))) %>% 
  kable(caption = "Shows the mean shift in the max theta values") 


```

## Discussion

As stated in @BUTTERFIELD20051932, previous research in this subject has determined that eccentric exercise shifts peak force to longer muscle lengths (or larger angles, in this experiment). Or data supports this as the angle at which maximum force was produced shifted up 14 degrees. Additionally, when looking at the graph, although messy, you can see a shift towards higher angles under the fatigued condition. Overall, our data supports previous research indicating that eccentrically fatigued muscles produce their greatest force at larger lengths (larger angles) than rested muscles.

## Author Contributions

Michael Bevilacqua: Data Collection and Code. <br> Ben Riccio: Data Collection, Code, Intro and Discussion.\
Baylie Larson: Data Collection, Code.\
Tara Gerjarusak: Data Collection.

## References
