---
title: "Module 7 Report"
author: "stRong_codeRs"
date: "2023-11-07"
output: html_document
bibliography: "BIOL3140.bib"
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(MuMIn)
library(tidyverse)
library(knitr)
```

## Introduction
Force produced by muslce tissue is determined by speed and length. This project will examine the effect of length of force generation and how eccentric fatigue affects this relationship. Force generated by the forearm can be used to gain insights into the force-length relationship, as outlined in @rassier1999length. We will use data generated at different angles to examine the force-length relationship, then how this relationship changes after the subject undergoes eccentric fatigue. 
By collecting and analyzing data we will determine how the angle at which maximum isometric force is produced changes across rested and fatigued subjects. 



## Methods
Isometric force produced by MVC was measured using a Arduina based force-data acquisiton system. The load cell was anchored to a table and force was measured over a range of angles 45-157.25 degrees for each subject. Subjects that eccentrically fatigued the forearm with isokinetic controlled drops using a heavy backpack. MVC force data was then collected again. 

Each subject's data was normalized to the max force value obtained. Models were then generated based on fit and AIC scores were assessed. Control and fatigued data with noise included was then graphed to assess differences between muslce condition. By running an ANOVA test on developed models, we determined that angle in max angle was different across the two conditions. This shift was then calcuated and is reported in results. 

## Results  
```{r}
f <- list.files("new_data", pattern = ".csv", full.names=TRUE)

dat.l <- list()

for(i in f){
  met.dat<- unlist(strsplit(i,"_"))
  who <- met.dat[3]
  activity <- met.dat[4]
  ang <- as.numeric(gsub(".csv","", met.dat[5]))
  dat.l[[i]]<- read_csv(i) %>%
  mutate(who = who, angle = ang, activity = activity) %>% 
  filter(!(who=="letiacianna" | who=="leticianna" & activity %in% c("fatigue","control")))%>%
  group_by(activity)%>%
  mutate(normF=abs(force/max(force))) %>%
  print()
}



dat <- do.call(rbind,dat.l)
print(dat)


```

```{r models, echo=FALSE, message=FALSE, warning=FALSE}

dat%>%
  ggplot(aes(angle,normF,col=activity))+geom_point()

AICs <- dat %>% 
  group_by(who,activity) %>% 
  summarize(
    pol.m2=AICc(lm(normF~poly(angle,2))),
    pol.m3=AICc(lm(normF~poly(angle,3))),
    pol.m4=AICc(lm(normF~poly(angle,4)))
  ) %>% 
  pivot_longer(pol.m2:pol.m4, names_to = "model", values_to = "AICc")

AICs %>% 
  kable(caption= "Table #1: Depicts the second, third, and fouth order polynomial models") %>% 
  print()

x.pred <- seq(45,157.5,length.out = 1000)

fits <- dat%>%
  group_by(who,activity)%>%
  summarize(
    pol.m2=predict(lm(normF~poly(angle,2)),newdata=data.frame(angle=x.pred)),
   pol.m3=predict(lm(normF~poly(angle,3)),newdata=data.frame(angle=x.pred)), 
    pol.m4=predict(lm(normF~poly(angle,4)),newdata=data.frame(angle=x.pred)) 
  )%>%
   pivot_longer(pol.m2:pol.m4,names_to="model")%>%
   group_by(who,activity,model)%>%
   summarize(theta_max=x.pred[which.max(value)])%>%
   print()

```


```{r best, echo=FALSE, message=FALSE, warning=FALSE}
best.models <- fits%>%
  left_join(AICs)%>%
  group_by(who,activity)%>%
  mutate(best=AICc==min(AICc))%>%
  filter(best==TRUE)%>%
  dplyr::select(-best)%>%
  print()
best.models %>% 
  kable(caption = "Table #2: Depicts the model that fits best, determined by the lowest AIC value")


```

```{r anova and best models, echo=FALSE, message=FALSE, warning=FALSE}
anova(lm(theta_max~activity,best.models)) %>% 
  print()

best.models%>%
  pivot_wider(id_cols=who,names_from = activity,values_from=theta_max)%>%
  mutate(shift=fatigue-control)%>%
  ungroup()%>%
  summarise(mean.shift=mean(shift,na.rm = TRUE),se.shift=sd(shift,na.rm=TRUE)/sqrt(length(shift))) %>% 
  kable(caption = "Table #3: Shows the mean shift in the max theta values")


```



## Discussion 
s stated in @BUTTERFIELD20051932, previous research in this subject has determined that eccentric exercise shifts peak force to longer muscle lengths (or larger angles, in this experiment). Or data supports this as the angle at which maximum force was produced shifted up consideredly, ____. 


## Author Contributions 
